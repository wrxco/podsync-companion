services:
  podsync:
    image: ghcr.io/wrxco/podsync:filename-template
    container_name: podsync
    restart: unless-stopped
    environment:
      PODSYNC_CONFIG_PATH: /app/config.toml
    volumes:
      - ./podsync/data:/app/data
      - ./podsync/db:/app/db
      - ./podsync/config.toml:/app/config.toml:ro

  podsync-companion:
    build:
      context: .
    container_name: podsync-companion
    restart: unless-stopped
    environment:
      - COMPANION_DB_URL=sqlite:////data/companion.db
      - COMPANION_SOURCE_DIR=/data/source
      - COMPANION_MEDIA_DIR=/data/media
      - COMPANION_POLL_INTERVAL_SECONDS=3
      - COMPANION_CHANNEL_SCAN_LIMIT=0
      - COMPANION_PUBLIC_BASE_URL=http://localhost:8080
      - COMPANION_MEDIA_URL_PATH=/media
      - COMPANION_MANUAL_FEED_PATH=/feeds/manual.xml
      - COMPANION_MANUAL_FEED_FILE=/data/manual.xml
      - COMPANION_MANUAL_FEED_TITLE=Podsync Companion Manual Feed
      - COMPANION_MANUAL_FEED_DESCRIPTION=Manually selected back-catalog episodes
      - COMPANION_DOWNLOAD_AUDIO=true
      - COMPANION_PODSYNC_CONFIG_PATH=/podsync/config.toml
      - COMPANION_PODSYNC_FEED_SYNC_INTERVAL_SECONDS=300
    ports:
      - "8080:8080"
    volumes:
      - ./companion-data:/data
      - ./podsync/config.toml:/podsync/config.toml:ro
